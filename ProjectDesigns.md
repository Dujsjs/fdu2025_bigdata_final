### 设计

* 项目管理

  * 参数管理：使用config.yaml进行全局参数的统一管理

* 用户界面交互

  * 命令行：初步
  * 网页端

* 数据处理

  * 知识库数据

    * 支持的文件类型

    | **文件类型**          | **LlamaIndex 内置或常见支持方式**                            | **依赖的库**                                          | 本项目是否支持 |
    | --------------------- | ------------------------------------------------------------ | ----------------------------------------------------- | -------------- |
    | **`.txt`**            | **内置支持**，无需额外依赖。                                 | 无                                                    | √              |
    | **`.json`**           | **内置支持**，可通过 `JSONReader` 或默认阅读器处理。         | 无                                                    | ×              |
    | **`.csv`**            | **内置支持**，可通过 `SimpleDirectoryReader` 或 `CSVReader` 处理。 | `pandas`                                              | ×              |
    | **`.pdf`**            | **社区支持/常用**，通过 `PdfReader` 或 `PymuPDFReader`。     | `pypdf` 或 `pymupdf`                                  | √              |
    | **`.docx` / `.pptx`** | **社区支持/常用**，通过 `DocxReader` 或 `PptxReader`。       | `python-docx` 等                                      | ×              |
    | **`.epub`**           | **社区支持/常用**，通过 `EpubReader`。                       | `ebooklib`                                            | ×              |
    | **`.png`, `.jpg`**    | **社区支持**，通过 `ImageReader` 进行 **OCR 文本提取**。     | `Pillow`, `pytesseract` (可能需要安装 Tesseract 软件) | ×              |

    * 操作：切片、向量化后入库

  * ML建模数据（全部工程化实现）

    * 统一的输入格式，便于与ML函数接口对接
    * 数据可API实时获取调用，用户能够自己选择产品、股票、时间等信息（命令行交互）
    * 按照股票类别自动选择对应的建模方法

* 投资产品分析功能

  * 获取各类型合约的基本信息，包括CS（股票）、ETF（交易所交易基金）、INDX（指数）、Future（期货）、Option（期权）

  * 分析金融合约的投资价值、投资风险，运用机器学习模型预测投资收益，并给出投资建议（如选股、选债券的建议）

    ```mermaid
    graph TD
    A[数据层] -->|get_price| B[特征层]
    A -->|get_live_ticks-弃用| B
    B --> C[价值分析模型]
    B --> D[风险分析模型]
    B --> E[收益预测模型]
    C & D & E --> F[投资建议引擎]
    F --> G[同类合约对比]
    F --> H[跨类合约对比]
    G & H --> I[JSON分析报告]
    ```

* 



### 附录

* 支持的产品与建议的用户画像

  #### 常见投资产品类别

  | **类别**                             | **典型示例**                                   | **核心特征（2025年现状）**                                   |
  | ------------------------------------ | ---------------------------------------------- | ------------------------------------------------------------ |
  | **股票（Equities）**                 | 个股（如科技股）、指数基金（如S&P 500 ETF）    | 高波动性、受宏观经济和情绪驱动；2025年AI交易占比超60%，实时数据流丰富。 |
  | **债券（Fixed Income）**             | 国债、公司债、绿色债券                         | 利率敏感性强；2025年央行数字货币（CBDC）影响利率模型，信用风险更依赖ESG评分。 |
  | **衍生品（Derivatives）**            | 期权、期货、结构性票据                         | 非线性风险、杠杆效应高；2025年监管强化，需整合实时市场情绪数据（如社交媒体）。 |
  | **基金（Funds）**                    | 共同基金、ETF、对冲基金                        | 分散化投资；2025年“智能贝塔”策略流行，强调因子投资（如质量、动量）。 |
  | **另类投资（Alternatives）**         | 房地产REITs、大宗商品、加密货币（如比特币ETF） | 低流动性、高不确定性；2025年加密资产被主流机构接纳，但波动性仍需特殊处理。 |
  | **现金及等价物（Cash Equivalents）** | 货币市场基金、短期国库券                       | 低风险、高流动性；2025年受通胀影响显著，常作为动态资产配置的缓冲工具。 |

  - **数据驱动 vs. 理论驱动**：
    
    - [x] **股票和基金**：依赖**高频时序数据**（如每分钟价格、交易量），建模以**机器学习为主**（如LSTM神经网络预测短期价格波动，或随机森林进行因子归因）。2025年，结合另类数据（如卫星图像、社交媒体情绪）提升预测精度。
    - [x] **债券和现金等价物**：以**宏观理论模型**为主导，如使用**VAR（向量自回归）模型**分析利率变动，或**期限结构模型**（如Nelson-Siegel）预测收益率曲线。数据清洗需处理CBDC政策事件等非平稳因素。
    - [x] **衍生品**：基于**解析模型**（如Black-Scholes用于期权定价），但2025年扩展为**混合方法**——用蒙特卡洛模拟捕捉非线性风险，同时整合NLP分析新闻事件对隐含波动率的影响。
    - [ ] **另类投资（如加密货币）**：高噪声数据要求**鲁棒性模型**，常用**强化学习**（如DQN）模拟市场行为，或**GARCH模型**处理波动聚集性；需额外处理监管变化（如2025年全球加密框架）。
    
  - **关键差异总结**：
    | **维度**     | **股票/基金**                 | **债券/现金**               | **衍生品/另类投资**          |
    | ------------ | ----------------------------- | --------------------------- | ---------------------------- |
    | **时间尺度** | 短期（分钟级至日级）          | 中长期（周级至年度）        | 极短期（毫秒级）或事件驱动   |
    | **核心方法** | 机器学习（LSTM、Transformer） | 计量经济学（VAR、协整分析） | 混合模型（解析+模拟+AI）     |
    | **风险焦点** | 市场风险、流动性风险          | 信用风险、利率风险          | 尾部风险、杠杆风险           |
    | **数据挑战** | 噪声大，需实时处理            | 低频数据，宏观指标滞后      | 非结构化数据多，监管影响显著 |

  ---

  #### **用户画像的方法界定**

  在金融投资中，**用户画像**指通过多源数据构建用户的投资偏好、风险能力和行为特征的数字化表示。2025年，随着GDPR 2.0和AI伦理规范落地，画像需平衡精准性与隐私保护。核心目标是**支持个性化投资建议**（如任务步骤4），而非简单分类。方法可分为三个层次：

  #### **用户画像的核心构成**
  - **基础维度**：人口统计（年龄、收入）、财务状况（资产规模、负债率）、投资经验（新手/专业）。
  - **行为维度**：交易频率、产品偏好（如倾向股票vs.债券）、风险响应（如市场下跌时的操作）。
  - **心理维度**：风险偏好（保守/激进）、投资目标（退休/教育）、ESG倾向（2025年关键变量）。

  #### **画像方法的关键步骤**
  1. **数据获取**：
     - **主动方式**：通过人机对话（任务步骤1）获取显性需求，如“您能承受的最大亏损是多少？”结合NLP分析对话文本，提取隐含特征（如用户多次提到“稳定”，标记为低风险偏好）。
     - **被动方式**：整合历史交易数据、KYC（了解客户）文件、第三方数据（如信用报告），但2025年需符合数据最小化原则（仅收集必要信息）。

  2. **特征工程**：
     - **结构化数据**：用标准化方法（如Z-score）处理数值特征（如月收入）。
     - **非结构化数据**：通过NLP（如BERT模型）解析对话文本，生成“风险情绪分数”或“目标关键词”（如“退休”→长期投资）。
     - **动态更新**：画像非静态，2025年主流做法是设置**触发机制**（如用户新开衍生品账户，自动更新风险等级）。

  3. **模型应用**：
     - **聚类分析**：用K-means或层次聚类将用户分组（如“保守型退休用户”“激进型科技投资者”），适用于初步分层。
     - **预测建模**：训练分类模型（如XGBoost）预测用户行为（如“高概率购买ESG基金”），输入特征包括对话摘要和交易历史。
     - **RAG增强**：在任务步骤2中，清洗后的投资规则（如“债券产品仅适合风险等级3以下用户”）被存入llama_index索引。当大模型对话中检测到关键信息（如用户说“我退休了”），RAG检索匹配规则，动态调整画像。
